{% extends 'base.html' %}
{% block title %}Create Depot{% endblock %}

{% block content %}

<div class="container">
  <div class="login-form" style="min-height: 600px; width: 600px;">
    <h3>Crie um novo Depósito!</h3>
    <form id="create-depot-form">
      <h4>Endereço</h4>
      <div class="input-container">
        <label for="street">Rua</label>
        <input type="text" name="street">
      </div>
      <div class="input-container">
        <label for="number">Número</label>
        <input type="text" name="number">
      </div>
      <div class="input-container">
        <label for="complement">Complemento</label>
        <input type="text" name="complement">
      </div>
      <div class="input-container">
        <label for="neighborhood">Bairro</label>
        <input type="text" name="neighborhood">
      </div>
      <div class="input-container">
        <label for="city">Cidade</label>
        <input type="text" name="city">
      </div>
      <div class="input-container">
        <label for="state">Estado</label>
        <input type="text" name="state">
      </div>
      <div class="input-container">
        <label for="cep">CEP</label>
        <input type="text" name="cep">
      </div>
      <div class="input-container">
        <label for="country">País</label>
        <input type="text" name="country" value="Brasil">
      </div>

      <h4 style="margin-top: 20px;">Informações do Depósito</h4>
      <div class="input-container">
        <label for="user">Email do Usuário</label>
        <input type="email" name="user">
      </div>
      <div class="input-container">
        <label for="name">Nome do Depósito</label>
        <input type="text" name="name">
      </div>
      <div class="input-container">
        <label for="contact">Contato</label>
        <input type="text" name="contact">
      </div>
      <div class="input-container">
        <label for="registration">Registro</label>
        <input type="text" name="registration">
      </div>

      <button class="red-btn" type="submit" style="margin-top: 20px;">Criar!</button>
    </form>
  </div>
</div>

<script>
  const createDepotForm = document.getElementById('create-depot-form');
  createDepotForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const formData = new FormData(createDepotForm);
    const data = Object.fromEntries(formData.entries());

    try {
      fetch("/api/depots", {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json",
        }
      }).then(res => res.json()).then(data => {
        if (data.error) {
          alert("Error: " + data.error);
        } else {
          alert(data.message);
          window.location.href = "/dashboard";
        }
      });
    } catch (error) {
      console.log("Error trying to send the request:", error);
      alert("An error occurred. Please try again.");
    }
  });
</script>

{%endblock%}
